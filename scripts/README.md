# Scripts

Utility scripts for the MTG Forge Rust project.

## Test Discovery and Timing

### `discoverTests.sh`

Discovers all test suites in the project and outputs their names, one per line.

**Usage:**
```bash
# List all test suites
./scripts/discoverTests.sh

# List only library test modules
./scripts/discoverTests.sh --lib

# List only integration tests
./scripts/discoverTests.sh --integration

# List binary test modules
./scripts/discoverTests.sh --bins
```

**Output format:**
One test suite identifier per line, suitable for use with `cargo test`:
```
core::mana
game::actions
loader::card
card_loading
database_load
...
```

**Example usage with xargs:**
```bash
# Run all lib tests in parallel
./scripts/discoverTests.sh --lib | xargs -I {} -P 4 cargo test --lib {}

# Time each test suite
for suite in $(./scripts/discoverTests.sh --lib); do
  hyperfine --warmup 1 "cargo test --lib $suite"
done
```

### `timeAllTests.sh`

Times all test suites individually using hyperfine and generates a report.

**Usage:**
```bash
# Time all library tests
./scripts/timeAllTests.sh --lib

# Time integration tests with 5 runs each
./scripts/timeAllTests.sh --integration --runs 5

# Custom output file
./scripts/timeAllTests.sh --output results.txt
```

**Options:**
- `--lib` - Only time library test modules
- `--integration` - Only time integration tests
- `--warmup N` - Number of warmup runs (default: 1)
- `--runs N` - Number of benchmark runs (default: 3)
- `--output FILE` - Output file (default: timestamped file in /tmp)

## Validation and Testing

### `validate.sh`

Runs all validation checks including tests, examples, and lints. This is the pre-commit validation script.

**Usage:**
```bash
./scripts/validate.sh
```

Runs:
1. `cargo test --lib` - All unit tests
2. `cargo test --test` - All integration tests
3. `./scripts/run_examples.sh` - All examples
4. `cargo clippy` - Linting

### `run_examples.sh`

Runs all examples in parallel using GNU parallel for faster execution.

**Usage:**
```bash
./scripts/run_examples.sh
```

Features:
- Parallel execution (~40% faster than sequential)
- Progress tracking
- Error reporting

## Profiling and Analysis

### `analyze_heapprofile.sh`

Analyzes heap profiles generated by jemalloc.

**Usage:**
```bash
./scripts/analyze_heapprofile.sh <heap-profile-file>
```

### `gogo_claude.sh`

Helper script for Claude Code development workflow.

## Version Control

### `gitdepth.sh`

Outputs the current commit count, used for timestamping documentation.

**Usage:**
```bash
./scripts/gitdepth.sh
# Output: commit#161(387498cecf)
```

This is used in documentation to track when information was recorded, e.g.:
```markdown
## Performance (as of commit#161)
- Test suite: 4.0s
- ...
```

## Dependencies

Some scripts require additional tools:

- **hyperfine**: For `timeAllTests.sh`
  ```bash
  apt-get install hyperfine
  ```

- **GNU parallel**: For `run_examples.sh`
  ```bash
  apt-get install parallel
  ```

- **jemalloc**: For heap profiling with `analyze_heapprofile.sh`
  ```bash
  apt-get install libjemalloc-dev
  ```

- **jq**: For JSON parsing in various scripts
  ```bash
  apt-get install jq
  ```
